# ポケモンしりとりゲーム

ポケモンの名前を使ったしりとりゲームです。Next.jsとTypeScriptで構築されています。

## プロジェクト情報

- **デプロイ先**: GitHub Pages
- **公開URL**: https://nyama.github.io/pokeshiri-game/
- **CI/CD**: GitHub Actions（自動デプロイ、統計データ3時間ごと更新）
- **フレームワーク**: Next.js 14 (App Router)
- **UI**: Material Design風、Bootstrap対応

## 概要

このゲームは、ポケモンの名前を使ってしりとりを楽しむWebアプリケーションです。プレイヤーは順番にポケモンの名前を入力し、前のポケモン名の最後の文字で始まるポケモン名を答えます。

## ゲームルール

### ゲームモード
- **シングルモード**: 通常のしりとりゲーム（時間制限なし）
- **タイムアタック（TA）モード**: 60秒の制限時間内でゴールを目指す
  - 残り時間×1ptのボーナス獲得
  - 別々のハイスコア記録

### 基本ルール
1. **しりとり**: 前のポケモンの最後の文字で始まるポケモン名を入力
2. **ゴール**: ランダムに選ばれたゴールポケモンを目指す
3. **重複禁止**: 一度使ったポケモンは再使用不可
4. **制限ポケモン**: フォルム違いなど一部のポケモンは使用不可

### スコアシステム
- **基本点**: 正解1つにつき1ポイント
- **タイプコンボ**: 前のポケモンとタイプが一致すると連続コンボでボーナス点
  - コンボ数に応じて追加ポイント（1コンボ目+2pt、2コンボ目+3pt...）
- **ゴールボーナス**: ゴール到達時に+10ポイント
- **パスペナルティ**: パス使用時に-2ポイント

### ゲーム機能
- **パス**: 3回まで使用可能（-2ポイント、次の文字をランダム変更）
- **ヒント**: ゴールポケモンの一部を表示（使用すると記録に残る）
- **プログレス**: 図鑑登録数に応じた達成度表示
- **シェア機能**: 同じ問題・モードでの再挑戦が可能
- **個人統計**: 自分のプレイ記録を詳細に管理・表示

### URLパラメータ
- **モード指定**: `?mode=timeattack` でタイムアタック、`?mode=single` でシングル（デフォルト）
- **問題指定**: `?start=001&goal=150` で特定のポケモン組み合わせ
- **組み合わせ**: `?start=001&goal=150&mode=timeattack` で問題とモードを同時指定

## 機能

- ポケモン名によるしりとりゲーム
- スコア表示
- ゲーム履歴の表示
- **個人統計機能**: 自分のプレイ記録を詳細管理
  - 遊んだゲーム数、クリア数、総回答数
  - モード別最高得点・最長チェーン数
  - 平均回答数/ゲーム、モード別プレイ回数
  - ローカルストレージで永続化
- レスポンシブデザイン
- PWA対応

## 技術スタック

- **フレームワーク**: Next.js 14 (App Router)
- **言語**: TypeScript
- **スタイリング**: Tailwind CSS + Bootstrap対応
- **UIコンポーネント**: shadcn/ui (Material Design風)
- **PWA**: Service Worker
- **デプロイ**: GitHub Pages
- **CI/CD**: GitHub Actions

## セットアップ

### 必要な環境

- Node.js 18以上
- npm または pnpm

### インストール

```bash
# 依存関係のインストール
npm install
# または
pnpm install
```

### 開発サーバーの起動

```bash
npm run dev
# または
pnpm dev
```

ブラウザで [http://localhost:3000](http://localhost:3000) を開いてアプリケーションを確認できます。

## 開発ガイドライン

### デザイン
- **UIフレームワーク**: Material Design風のデザインを採用
- **CSSフレームワーク**: Bootstrap使用時はBootstrapクラスを優先
- **レスポンシブ**: モバイルファーストでデザイン

### JavaScript
- **TypeScript**: 型安全性を重視
- **コンポーネント**: React関数コンポーネントを使用

### デプロイメント
- **自動デプロイ**: mainブランチへのpushで自動的にGitHub Pagesにデプロイ
- **統計データ**: GitHub Actionsで3時間ごとに自動更新（stats.jsonは.gitignoreで除外）

### アナリティクス（Google Analytics）
- **イベント追跡**: ゲームクリア・ゲームオーバー・ポケモン回答を記録
- **カスタムパラメータ**: 
  - `score`: 最終スコア
  - `chain_length`: つないだポケモン数
  - `game_mode`: ゲームモード（single/timeattack）
- **累計データ**: 全プレイヤーの統計データを収集・分析

#### 現在GAスクリプトで保存している統計項目（stats.json）
- **基本統計**:
  - `totalPokemonAnswers`: 総ポケモン回答数
  - `totalGameClears`: 総ゲームクリア数
  - `totalGameOvers`: 総ゲームオーバー数
  - `totalGames`: 総ゲーム数（クリア + オーバー）
  - `clearRate`: クリア率（%）
  - `averageAnswersPerGame`: 1ゲームあたりの平均回答数
- **記録統計**:
  - `maxScore`: シングルモード最高スコア（カスタムディメンション使用）
  - `maxScoreTA`: タイムアタックモード最高スコア（カスタムディメンション使用）
  - `maxChainLength`: シングルモード最長チェーン（カスタムディメンション使用）
  - `maxChainLengthTA`: タイムアタックモード最長チェーン（カスタムディメンション使用）
- **メタデータ**:
  - `serviceStartDate`: サービス開始日（2024-01-15）
  - `lastUpdated`: 最終更新日時
  - `error`: エラーメッセージ（エラー時のみ）

#### 実装済み（カスタムディメンション必要）
- **モード別統計**: シングル/タイムアタック別の最高スコア・最長チェーン
- **実際の最高スコア**: カスタムパラメータ `score` + `game_mode` からの取得
- **実際の最長チェーン**: カスタムパラメータ `chain_length` + `game_mode` からの取得

⚠️ **注意**: カスタムディメンションが設定されていない場合は0固定値になります

### 個人統計機能（ローカルストレージ）
- **データ管理**: ブラウザのローカルストレージで個人記録を永続化
- **統計項目**:
  - `totalGamesPlayed`: 遊んだゲーム数
  - `totalGameClears`: クリア数
  - `totalAnswers`: 総回答数
  - `bestSingleScore` / `bestTimeattackScore`: モード別最高得点
  - `longestChainSingle` / `longestChainTimeattack`: モード別最長チェーン
  - `singleModeGames` / `timeattackModeGames`: モード別プレイ回数
  - `averageAnswersPerGame`: 平均回答数/ゲーム
- **自動更新**: ゲーム開始・終了時に統計を自動更新
- **表示**: 統計モーダルで累計データと分離して表示

## ビルド

```bash
npm run build
# または
pnpm build
```

## プロジェクト構造

```
├── app/                    # Next.js App Router
├── components/             # Reactコンポーネント
│   ├── ui/                # UIコンポーネント
│   └── ...                # ゲーム関連コンポーネント
├── lib/                   # ユーティリティとデータ
├── public/                # 静的ファイル
└── styles/                # スタイルファイル
```

## ライセンス

MIT License